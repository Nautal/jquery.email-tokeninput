!function(a){a.fn.mailToken=function(b){function h(b){c=a(b),c.addClass("mt-container"),i(),n(),j(),c.append('<div style="clear:both;"></div>')}function i(){var b=a("<textarea/>",{style:"display:none;",name:g.name});c.append(b),d=c.find("textarea")}function j(){var b=a("<ul/>",{class:"mt-ul"});c.prepend(b),f=c.find(b)}function k(){if(l())return void u();var b=a("<li/>",{class:"mt-token",html:e.val()+' <span class="mt-token-erase">Ã—</span>'});f.append(b),x()}function l(){if(""==e.val()||void 0==e.val())return!0;var b=!1;return f.children("li").each(function(){a(this).html()==e.val()&&(b=!0)}),b}function m(){return e.val().match(g.regex)}function n(){var b=a("<input/>",{style:"display:none;",name:g.name+"-input",blur:function(){o(a(this))}});c.append(b),e=c.find("input")}function o(a){""!=a.val()&&void 0!=a.val||a.hide()}function o(a){""!=a.val()&&void 0!=a.val||a.hide()}function p(){c.click(w),c.click(function(){f.children("li").removeClass("mt-selected")}),e.on("keydown",s),document.getElementById("mailtoken").addEventListener("keydown",q)}function q(a){13!=a.keyCode&&32!=a.keyCode&&188!=a.keyCode||r(a),27==a.keyCode&&(e.val(""),e.hide(),f.children("li").removeClass("mt-selected")),39==a.keyCode&&(e.is(":visible")||(e.show(),e.focus(),f.children("li").removeClass("mt-selected")))}function r(a){e.is(":visible")&&a.preventDefault(),e.is(":visible")&&!e.is(":focus")&&(u(),e.focus())}function s(a){13!=a.keyCode&&32!=a.keyCode&&188!=a.keyCode||t(),8==a.keyCode&&o(e)}function t(){if(m())return v(),k(),void y();u()}function u(){e.addClass("mt-error")}function v(){e.removeClass("mt-error")}function w(){e.show(),e.focus()}function x(){e.val("")}function y(){var a=JSON.stringify(z());d.val(a)}function z(){var b=[];return f.children("li").each(function(){b.push(a(this).html().split(" ")[0])}),b}var c=null,d=null,e=null,f=null,g={name:"emailtoken",regex:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i};return this.each(function(){h(this),p()})},a(document).on("click",".mt-token-erase",function(){a(this).parent().remove()})}(jQuery);